---
title: 动量法
tags:
  - 深度学习
  - 线性回归
date: 2026-02-08 13:00:00
mathjax: "true"
categories:
  - 深度学习
  - 线性回归
---
<style>
/* 强制让 MathJax 公式容器支持横向滚动 */
.mjx-container, .MathJax_Display, .MathJax {
    overflow-x: auto !important; /* 超出宽度时显示滚动条 */
    overflow-y: hidden;          /* 隐藏垂直滚动条 */
    max-width: 100%;             /* 限制最大宽度为屏幕宽度 */
    -webkit-overflow-scrolling: touch; /* 优化移动端滑动体验 */
}
</style>

动量法旨在加速 SGD 在相关方向上的收敛，并抑制无关方向上的震荡。在时间步 $t$，给定目标函数 $f(\mathbf{x})$ 关于参数 $\mathbf{x}$ 的梯度 $\mathbf{g}_t = \nabla_{\mathbf{x}} f(\mathbf{x}_t)$，引入速度向量 $\mathbf{v}_t$，其更新公式如下

$$
\begin{aligned}
\mathbf{v}_{t+1} &= \mu \mathbf{v}_t + \eta \mathbf{g}_t \\
\mathbf{x}_{t+1} &= \mathbf{x}_t - \mathbf{v}_{t+1}
\end{aligned}
$$

其中，$\mu \in [0, 1)$ 为 **动量系数**（通常取 0.9），$\eta$ 为**学习率**

### 构造与推导
考虑一个局部呈现为狭长山谷状地损失函数表面。如果不适用动量，SGD的更新公式为$\mathbf{x}_{t+1} = \mathbf{x}_t - \eta \mathbf{g}_t$，此时出现两个问题

- 在山谷的横截面方向（高曲率，梯度大），$\mathbf{g}_t$很大，导致参数在山谷两壁间剧烈震荡
- 在山谷的延伸方向（低曲率，梯度小），$\mathbf{g}_t$很小，导致收敛的速度极慢

而我们所需要的是，我们希望算法能够记住之前的更新方向，在震荡方向上相互抵消，在平缓方向上累积速度

我们需要引入一个**时间平滑**机制

1. 如果连续多次的方向一致（平滑），步长应增大
2. 如果连续梯度的方向相反（震荡），步长应减小

**所以**，我们将当前的更新向量不再仅仅设为当前梯度，而是设为当前梯度与过去梯度的**指数加权移动平均**
定义累积变量 $\mathbf{v}_t$。在 $t=0$ 时，$\mathbf{v}_0 = 0$。
在 $t=1$ 时，$\mathbf{v}_1 = \eta \mathbf{g}_0$。
在 $t=2$ 时，我们要保留 $\mathbf{v}_1$ 的一部分，并加上新的梯度：$\mathbf{v}_2 = \mu \mathbf{v}_1 + \eta \mathbf{g}_1$。
展开递归式：

$$\mathbf{v}_{t+1} = \eta \mathbf{g}_t + \mu (\eta \mathbf{g}_{t-1} + \mu \mathbf{v}_{t-1}) = \eta \sum_{\tau=0}^{t} \mu^{t-\tau} \mathbf{g}_\tau$$

观察此式：

- 当梯度方向一致时（$\text{sign}(\mathbf{g}_t) = \text{sign}(\mathbf{g}_{t-1})$），$\mathbf{v}$ 的模长会增大，起到加速作用。
- 当梯度方向改变时（$\text{sign}(\mathbf{g}_t) \neq \text{sign}(\mathbf{g}_{t-1})$），正负项在求和中互相抵消，起到抑制震荡作用。